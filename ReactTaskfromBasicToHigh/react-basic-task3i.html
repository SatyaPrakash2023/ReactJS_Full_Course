<!DOCTYPE html>
<html>
  <head>
    <title>Chat Bot</title>
  </head>
  <body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="chatBotResponseScript.js" defer></script>

    <script type="text/babel">
      const container = document.querySelector('.js-container');
      function ChatBotInput({chatMessages, setChatMessages}){

        const [inputText, setInputText] = React.useState('');

        function saveInputTextToState(event){
          setInputText(event.target.value);
        
        }

        async function sendMessage(event){
          if(event.type==='keydown' && event.key =='Escape'){
            return;
          }

          const newChatMessages=[
            ...chatMessages, {
            message: inputText,
            sender: "User",
            id: `Uk0${chatMessages.length + 1}`
          }]
          setChatMessages(newChatMessages);
          // console.log("Send Message button clicked with message:", inputText);
          const response = await Chatbot.getResponse(inputText);
          
          setChatMessages([
            ...newChatMessages, {
            message: response,
            sender: "chiti",
            id: `Ch0${chatMessages.length + 1}`
          }]);

          setInputText('');
        }

        return (
          <>
              <input placeholder="Send a message to chatbot" id="user-input" size="30" autoComplete="off" onChange={saveInputTextToState} value={inputText} />
              <button onClick={sendMessage} id="send-btn">Send</button>
          </>        
       ) 
      };

      function ChatMessage({message, sender }){
        return (
          <div id="chat">
            {sender==='chiti'&& <img src="chatbotImage.png" width="50p"/>}
            {message}
            {sender ==='User' && <img src="UserProfileImage.png" width="50p"/>}
          </div>
        );
      }

      function ChatMessages({chatMessages}){
        
        return (
          <>
            {chatMessages.map((chatMessages)=>{
              return (
                <ChatMessage message={chatMessages.message} sender={chatMessages.sender} key={chatMessages.id} />
              );
            })}
          </>
        );  
      }

      function App(){

        const [chatMessages,setChatMessages] = React.useState([{
            message: "hello chatBot",
            sender: "User",
            id: 'Uk01'
          },{
            message: "Hello! I am chiti how can i help you ?",
            sender: "chiti",
            id: 'Ch01'
          },{
            message: "Can you get me today's date ?",
            sender: "User",
            id: 'Uk02'
          },{
            message: "Today is 9th NOV 2025",
            sender: "chiti",
            id: 'Ch02' 
         }]);
        
        return (
          <>
            <ChatBotInput  chatMessages={chatMessages} setChatMessages={setChatMessages}/>
            <ChatMessages chatMessages={chatMessages} />
          </>
        );
      }

      ReactDOM.createRoot(container).render(<App/>);
    </script>
  </body>
</html>
